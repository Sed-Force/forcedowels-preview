<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order â€” Force Dowelsâ„¢</title>
  <meta name="description" content="Order Force Dowelsâ„¢ in bulk tiers or starter kits.">
  <link rel="icon" href="/favicon.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css?v=101" />

  <!-- Clerk (Browser) -->
  <script
    async
    crossorigin="anonymous"
    data-clerk-publishable-key="pk_test_dmlhYmxlLWhhZGRvY2stMzYuY2xlcmsuYWNjb3VudHMuZGV2JA"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">
  </script>

  <script defer src="scripts/customer/script.js?v=102"></script>
  <script defer src="scripts/customer/script-order.js?v=auth-fix-20251021"></script>
  <!-- Force theme override for order page -->
  <style>
    /* Aggressive theme override - force theme variables to work */
    [data-theme="dark"] .tier,
    [data-theme="dark"] .kit {
      background: #1e2a3f !important;
      color: #ffffff !important;
      border-color: #334155 !important;
    }

    [data-theme="dark"] .tier.active {
      background: #243042 !important;
      border-color: #eead1a !important;
    }

    [data-theme="dark"] .calc {
      background: #1e2a3f !important;
      border-color: #334155 !important;
      color: #ffffff !important;
    }

    [data-theme="dark"] .tier-price {
      color: #fbbf24 !important;
      font-weight: 800 !important;
    }

    [data-theme="dark"] .tier-lock,
    [data-theme="dark"] .kit .muted {
      color: #cbd5e1 !important;
    }

    [data-theme="light"] .tier,
    [data-theme="light"] .kit {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%) !important;
      color: #000000 !important;
      border-color: #9ca3af !important;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08) !important;
    }

    [data-theme="light"] .tier.active {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%) !important;
      border-color: #eead1a !important;
      box-shadow: 0 8px 24px rgba(238, 173, 26, 0.15) !important;
    }

    [data-theme="light"] .calc {
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%) !important;
      border-color: #9ca3af !important;
      color: #000000 !important;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08) !important;
    }

    [data-theme="light"] .tier-price {
      color: #d97706 !important;
      font-weight: 800 !important;
    }

    [data-theme="light"] .tier-lock,
    [data-theme="light"] .kit .muted {
      color: #1f2937 !important;
    }


  </style>
</head>
<body>

<!-- Header -->
<header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="/" aria-label="Force Dowel Company">
      <img src="/images/force-dowel-logo.jpg" alt="Force Dowel Company logo" />
    </a>

    <nav class="nav" aria-label="Primary">
      <a href="/">Home</a>
      <a href="/order.html" class="active">Order</a>
      <a href="/videos.html">Videos</a>
      <a href="/faq.html">FAQ</a>

      <div class="nav-dropdown">
        <button class="nav-dropbtn" type="button" aria-haspopup="true" aria-expanded="false">
          <span class="nav-drop-label">Distributors</span>
          <span class="nav-caret">â–¾</span>
        </button>
        <div class="nav-dropmenu" role="menu">
          <a href="/distributors" role="menuitem">Find a Distributor</a>
          <a href="/distributor-application" role="menuitem">Become a Distributor</a>
        </div>
      </div>

      <a href="/contact.html" class="btn btn--accent">Contact</a>
    </nav>

    <div class="header-actions">
      <!-- Theme Toggle -->
      <button class="btn btn--ghost btn--invert" id="theme-toggle" type="button" aria-label="Toggle theme">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="theme-icon theme-icon-light">
          <path fill="currentColor" d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12M12 2a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1m0 18a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1M20.66 7.34a1 1 0 0 1 0 1.41l-.71.71a1 1 0 1 1-1.41-1.41l.71-.71a1 1 0 0 1 1.41 0M5.46 17.54a1 1 0 0 1 0 1.41l-.71.71a1 1 0 1 1-1.41-1.41l.71-.71a1 1 0 0 1 1.41 0M22 12a1 1 0 0 1-1 1h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1M4 12a1 1 0 0 1-1 1H2a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1m16.66 4.66a1 1 0 0 1-1.41 0l-.71-.71a1 1 0 0 1 1.41-1.41l.71.71a1 1 0 0 1 0 1.41M7.75 6.25a1 1 0 0 1-1.41 0l-.71-.71a1 1 0 0 1 1.41-1.41l.71.71a1 1 0 0 1 0 1.41"/>
        </svg>
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" class="theme-icon theme-icon-dark">
          <path fill="currentColor" d="M12 21q-3.75 0-6.375-2.625T3 12q0-3.75 2.625-6.375T12 3q.35 0 .688.025t.662.075q-1.025.725-1.638 1.888T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q1.375 0 2.525-.613T20.9 10.65q.05.325.075.662T21 12q0 3.75-2.625 6.375T12 21"/>
        </svg>
      </button>

      <a href="/cart.html" class="btn btn--ghost btn--invert" aria-label="Shopping cart">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M7 18a2 2 0 1 0 0 4a2 2 0 0 0 0-4m10 0a2 2 0 1 0 0 4a2 2 0 0 0 0-4M6.2 6l.3 2h12.3a1 1 0 0 1 1 1l-1.2 6a2 2 0 0 1-2 1.6H8.7a2 2 0 0 1-2-1.7L5.3 5H3V3h3a1 1 0 0 1 1 .9L7.2 6Z"/>
        </svg>
        <span class="hide-sm">Cart</span>
        <span id="cart-count" class="badge"></span>
      </a>

      <!-- Shown when signed IN (Clerk mounts here) -->
      <div id="user-button"></div>
    </div>
  </div>
</header>

<main id="content" class="order-page">
  <!-- Spacer -->
  <section class="section">
    <div class="container"></div>
  </section>

  <!-- Pricing + Calculator -->
  <section class="section">
    <div class="container order-grid">

      <!-- LEFT: Pricing tiers -->
      <div class="tiers">
        <h2>Pricing Tiers</h2>

        <div class="notice">
          <strong>Guest Checkout Available:</strong>
          Orders of 5,000â€“20,000 units and all kit purchases can be completed without an account.
        </div>

        <!-- Exactly one tier is active at a time. Clicking swaps the yellow outline. -->
        <button class="tier active" type="button" data-min="5000">
          <span class="tier-range">5,000â€“24,999</span>
          <span class="tier-price">$0.0720/Unit</span>
        </button>

        <button class="tier" type="button" data-min="25000" data-requires-auth="true">
          <span class="tier-lock">ðŸ”’</span>
          <span class="tier-range">25,000â€“164,999</span>
          <span class="tier-price">$0.0675/Unit</span>
        </button>

        <button class="tier" type="button" data-min="165000" data-requires-auth="true">
          <span class="tier-lock">ðŸ”’</span>
          <span class="tier-range">165,000â€“960,000</span>
          <span class="tier-price">$0.0630/Unit</span>
        </button>

        <h3 class="mt">Or Try Our Starter Kit</h3>
        <button class="kit" id="starter-kit" type="button">
          <div>
            <strong>Force Dowels Kit</strong>
            <div class="muted">Perfect for small projects and testing</div>
          </div>
          <div class="kit-right">
            <strong>$36.00</strong>
            <div class="muted">300 dowels â€¢ $0.12/unit</div>
          </div>
        </button>

        <h3 class="mt">Need a Custom Quote?</h3>
        <p>For orders exceeding 960,000 units or for special requirements, please contact our sales team.</p>
        <a class="btn btn--accent" href="/contact.html">Contact Sales</a>

        <h3 class="mt">International Orders</h3>
        <p style="font-size: 14px; color: #6b7280; margin-bottom: 12px;">Don't see your country listed? Click here to make an order and request shipping rates.</p>
        <button class="btn btn--primary" type="button" onclick="openInternationalOrderModal()">International Orders</button>
      </div>

      <!-- RIGHT: Calculator -->
      <aside class="calc">
        <h2>Calculate Your Price</h2>

        <div class="calc-callout">
          <strong>Ordering Requirements:</strong> Orders are available in 5,000-unit increments only.
          Minimum 5,000 units, maximum 960,000 units.
        </div>

        <!-- Quantity controls -->
        <div class="field">
          <label for="qty-units">Quantity (units)</label>
          <div class="qtywrap">
            <button id="qty-minus" class="step" type="button" aria-label="decrease">â€“</button>
            <input id="qty-units" type="number" step="5000" min="5000" max="960000" value="5000" inputmode="numeric" />
            <button id="qty-plus" class="step" type="button" aria-label="increase">+</button>
            <span class="units">units</span>
          </div>
        </div>

        <!-- Price readouts -->
        <div class="row">
          <span>Price per unit:</span>
          <strong id="price-per-unit">$0.0720</strong>
        </div>

        <div class="row">
          <span>Total price:</span>
          <strong id="price-total">$360.00</strong>
        </div>

        <!-- Add to cart -->
        <button id="btn-add-to-cart" class="btn btn--accent btn-wide" type="button">Add to Cart</button>
        <p class="viewcart"><a href="/cart.html">View Cart</a></p>
      </aside>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-main">
    <section class="footer-sec footer-sec--brand">
      <a href="/" aria-label="Force Dowels home" class="footer-brand-wrap">
        <img src="/images/force-dowel-logo.jpg?v=4" alt="Force Dowels logo" class="footer-logo" />
      </a>
      <p class="footer-tagline">
        Revolutionary cabinetry fasteners that deliver faster assembly, stronger connections, and flawless finishes.
        Experience the next generation of cabinet construction.
      </p>
    </section>

    <section class="footer-sec">
      <h4>Quick Links</h4>
      <ul class="footer-list">
        <li><a href="/">Home</a></li>
        <li><a href="/order.html">Order Now</a></li>
        <li><a href="/videos.html">Product Videos</a></li>
        <li><a href="/distributors">Find a Distributor</a></li>
        <li><a href="/distributor-application">Become a Distributor</a></li>
      </ul>
    </section>

    <section class="footer-sec">
      <h4>Contact Us</h4>
      <ul class="footer-list">
        <li>(480)-581-7145</li>
        <li>Hours: Monâ€“Thurs 7:30AMâ€“4:30PM; Friday 7:30AMâ€“11:30AM</li>
        <li><a href="mailto:info@forcedowels.com">info@forcedowels.com</a></li>
        <li>4455 E Nunneley Rd, Ste 103<br>Gilbert, AZ 85296</li>
      </ul>
    </section>

    <section class="footer-sec">
      <h4>Stay Updated</h4>
      <p class="footer-note">Get the latest updates on our patent-pending technology and new product releases.</p>
      <form class="footer-form" onsubmit="return false;">
        <label class="sr-only" for="newsletter-email">Enter your email</label>
        <input id="newsletter-email" type="email" placeholder="Enter your email" required>
        <button type="submit" class="btn btn--accent">Subscribe</button>
      </form>
      <p class="footer-privacy-note">We respect your privacy. Unsubscribe at any time.</p>
    </section>
  </div>

  <div class="footer-separator"></div>

  <div class="container footer-bottom">
    <div class="footer-bottom-left">
      <p>Â© <span id="year"></span> Force Dowels. All rights reserved.</p>
      <p class="footer-patent">Patent Pending Technology - Revolutionary Cabinetry Fasteners</p>
    </div>
    <nav class="footer-bottom-right">
      <a href="/privacy.html">Privacy Policy</a>
      <a href="/terms.html">Terms of Service</a>
    </nav>
  </div>
</footer>

<!-- International Order Modal -->
<div id="international-modal" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 700px;">
    <div class="modal-header">
      <h2>International Order Form</h2>
      <button class="close-btn" onclick="closeInternationalOrderModal()">&times;</button>
    </div>

    <form id="international-order-form" onsubmit="submitInternationalOrder(event)">
      <div class="form-row">
        <label for="intl-order-type">Order Type *</label>
        <select id="intl-order-type" name="order_type" required onchange="toggleQuantityFields()">
          <option value="">Select order type...</option>
          <option value="kit">Ship Kits (300 dowels each)</option>
          <option value="bulk">Bulk Boxes (5,000+ dowels in 5,000 increments)</option>
        </select>
      </div>

      <!-- Ship Kit Quantity -->
      <div id="kit-quantity-section" class="form-row" style="display: none;">
        <label for="intl-kit-qty">Number of Ship Kits *</label>
        <input type="number" id="intl-kit-qty" name="kit_quantity" min="1" max="100" placeholder="e.g., 5 kits = 1,500 dowels">
        <small>Each kit contains 300 dowels ($36.00 per kit)</small>
      </div>

      <!-- Bulk Quantity -->
      <div id="bulk-quantity-section" class="form-row" style="display: none;">
        <label for="intl-bulk-qty">Bulk Quantity (units) *</label>
        <input type="number" id="intl-bulk-qty" name="bulk_quantity" min="5000" step="5000" max="960000" placeholder="e.g., 35000">
        <small>Minimum 5,000 units in 5,000 unit increments (max 960,000)</small>
      </div>

      <div class="form-row">
        <label for="intl-business-name">Official Business Name *</label>
        <input type="text" id="intl-business-name" name="business_name" required>
      </div>

      <div class="form-row">
        <label for="intl-contact-name">Contact Name *</label>
        <input type="text" id="intl-contact-name" name="contact_name" required>
      </div>

      <div class="form-row">
        <label for="intl-email">Email Address *</label>
        <input type="email" id="intl-email" name="email" required>
      </div>

      <div class="form-row">
        <label for="intl-phone">Valid Phone Number *</label>
        <input type="tel" id="intl-phone" name="phone" required placeholder="+1 234 567 8900">
      </div>

      <div class="form-row">
        <label for="intl-address">Official Shipping Address *</label>
        <textarea id="intl-address" name="shipping_address" rows="4" required placeholder="Street Address&#10;City, State/Province&#10;Postal/Zip Code&#10;Country"></textarea>
      </div>

      <div class="form-row">
        <label for="intl-shipping-label">Shipping Label (Optional)</label>
        <input type="file" id="intl-shipping-label" name="shipping_label" accept="image/*,.pdf">
        <small>Upload an image or PDF of your shipping label if available</small>
      </div>

      <div class="form-row">
        <label for="intl-tax-id">Business Tax ID Number *</label>
        <input type="text" id="intl-tax-id" name="tax_id" required placeholder="e.g., VAT, GST, or EIN">
      </div>

      <div class="form-row">
        <label for="intl-comments">Additional Comments (Optional)</label>
        <textarea id="intl-comments" name="comments" rows="3" placeholder="Any special requirements or notes..."></textarea>
      </div>

      <div class="form-disclaimer">
        <p><small>For international orders, we use a third-party shipper. Requests for international rates can take up to 1â€“3 business days.</small></p>
      </div>

      <div class="modal-actions">
        <button type="submit" class="btn btn--primary" name="action" value="request">
          Submit Request
        </button>
        <button type="submit" class="btn btn--accent" name="action" value="reserve">
          Reserve Stock & Request Rates
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow-y: auto;
    padding: 20px;
  }

  .modal-content {
    background: white;
    border-radius: 12px;
    padding: 0;
    max-height: 90vh;
    overflow-y: auto;
    width: 100%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  }

  .modal-header {
    padding: 24px;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #1C4A99;
    border-radius: 12px 12px 0 0;
  }

  .modal-header h2 {
    margin: 0;
    font-size: 24px;
    color: #ffffff;
  }

  .close-btn {
    background: none;
    border: none;
    font-size: 32px;
    color: #ffffff;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: background 0.2s;
  }

  .close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  #international-order-form {
    padding: 24px;
  }

  .form-row {
    margin-bottom: 20px;
  }

  .form-row label {
    display: block;
    font-weight: 600;
    margin-bottom: 6px;
    color: #374151;
    font-size: 14px;
  }

  .form-row input[type="text"],
  .form-row input[type="email"],
  .form-row input[type="tel"],
  .form-row select,
  .form-row textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    font-family: inherit;
    transition: border-color 0.2s;
  }

  .form-row input:focus,
  .form-row select:focus,
  .form-row textarea:focus {
    outline: none;
    border-color: #1C4A99;
    box-shadow: 0 0 0 3px rgba(28, 74, 153, 0.1);
  }

  .form-row input[type="file"] {
    padding: 8px 0;
  }

  .form-row small {
    display: block;
    margin-top: 4px;
    color: #6b7280;
    font-size: 12px;
  }

  .form-disclaimer {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 12px 16px;
    margin: 20px 0;
    border-radius: 4px;
  }

  .form-disclaimer p {
    margin: 0;
    color: #92400e;
  }

  .modal-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    padding-top: 20px;
    border-top: 1px solid #e5e7eb;
  }

  .modal-actions button {
    flex: 1;
    max-width: 250px;
  }

  @media (max-width: 640px) {
    .modal-actions {
      flex-direction: column;
    }

    .modal-actions button {
      max-width: none;
    }
  }
</style>

<script>
  (function(){var y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();})();

  // International Order Modal Functions
  function openInternationalOrderModal() {
    document.getElementById('international-modal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }

  function closeInternationalOrderModal() {
    document.getElementById('international-modal').style.display = 'none';
    document.body.style.overflow = '';
    document.getElementById('international-order-form').reset();
    // Hide both quantity sections on reset
    document.getElementById('kit-quantity-section').style.display = 'none';
    document.getElementById('bulk-quantity-section').style.display = 'none';
  }

  function toggleQuantityFields() {
    const orderType = document.getElementById('intl-order-type').value;
    const kitSection = document.getElementById('kit-quantity-section');
    const bulkSection = document.getElementById('bulk-quantity-section');
    const kitInput = document.getElementById('intl-kit-qty');
    const bulkInput = document.getElementById('intl-bulk-qty');

    if (orderType === 'kit') {
      kitSection.style.display = 'block';
      bulkSection.style.display = 'none';
      kitInput.required = true;
      bulkInput.required = false;
      bulkInput.value = '';
    } else if (orderType === 'bulk') {
      kitSection.style.display = 'none';
      bulkSection.style.display = 'block';
      kitInput.required = false;
      bulkInput.required = true;
      kitInput.value = '';
    } else {
      kitSection.style.display = 'none';
      bulkSection.style.display = 'none';
      kitInput.required = false;
      bulkInput.required = false;
    }
  }

  // Close modal when clicking outside
  document.getElementById('international-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeInternationalOrderModal();
    }
  });

  async function submitInternationalOrder(event) {
    event.preventDefault();

    const form = event.target;
    const submitBtn = event.submitter;
    const action = submitBtn.value; // 'request' or 'reserve'

    // Disable buttons during submission
    const buttons = form.querySelectorAll('button[type="submit"]');
    buttons.forEach(btn => {
      btn.disabled = true;
      btn.textContent = btn.value === action ? 'Processing...' : btn.textContent;
    });

    try {
      const formData = new FormData(form);
      const orderType = formData.get('order_type');

      // Build quantity data based on order type
      let quantityData = {};
      if (orderType === 'kit') {
        const kitQty = parseInt(formData.get('kit_quantity')) || 1;
        quantityData = {
          order_type: 'kit',
          quantity: kitQty,
          units: kitQty * 300,
          display: `${kitQty} Ship Kit${kitQty > 1 ? 's' : ''} (${kitQty * 300} dowels)`
        };
      } else if (orderType === 'bulk') {
        const bulkQty = parseInt(formData.get('bulk_quantity')) || 5000;
        quantityData = {
          order_type: 'bulk',
          quantity: bulkQty,
          units: bulkQty,
          display: `${bulkQty.toLocaleString()} dowels (Bulk)`
        };
      }

      const data = {
        action: action,
        ...quantityData,
        business_name: formData.get('business_name'),
        contact_name: formData.get('contact_name'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        shipping_address: formData.get('shipping_address'),
        tax_id: formData.get('tax_id'),
        comments: formData.get('comments') || ''
      };

      // Handle file upload if present
      const fileInput = document.getElementById('intl-shipping-label');
      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        // Convert file to base64 for email attachment
        const reader = new FileReader();
        const fileData = await new Promise((resolve, reject) => {
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
        data.shipping_label = {
          filename: file.name,
          content: fileData,
          type: file.type
        };
      }

      // Submit to API
      const response = await fetch('/api/international-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.error || 'Failed to submit request');
      }

      // Handle success based on action
      if (action === 'reserve') {
        // Check if manual processing is required
        if (result.requiresManualProcessing) {
          alert('Your stock reservation request has been submitted successfully! Our team will contact you within 1-3 business days to complete payment and arrange international shipping.');
          closeInternationalOrderModal();
        } else if (result.checkoutUrl) {
          // Redirect to Stripe checkout
          window.location.href = result.checkoutUrl;
        } else {
          throw new Error('No checkout URL returned');
        }
      } else {
        // Show success message
        alert('Your international order request has been submitted successfully! Our team will contact you within 1-3 business days with shipping rates.');
        closeInternationalOrderModal();
      }

    } catch (error) {
      console.error('Error submitting international order:', error);
      alert('Error: ' + error.message);

      // Re-enable buttons
      buttons.forEach(btn => {
        btn.disabled = false;
        if (btn.value === 'request') {
          btn.textContent = 'Submit Request';
        } else {
          btn.textContent = 'Reserve Stock & Request Rates';
        }
      });
    }
  }
</script>

<!-- Clean theme toggle for order page -->
<script>
// Immediate theme application
function applyThemeImmediate() {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme && savedTheme !== 'auto') {
    document.documentElement.setAttribute('data-theme', savedTheme);
  }
}

// Apply theme immediately
applyThemeImmediate();

document.addEventListener('DOMContentLoaded', function() {
  // Multiple attempts to find and initialize the theme toggle
  function initThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle');

    if (themeToggle) {
      // Remove any existing listeners
      const newButton = themeToggle.cloneNode(true);
      themeToggle.parentNode.replaceChild(newButton, themeToggle);

      // Add fresh click handler
      newButton.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();

        const currentTheme = document.documentElement.getAttribute('data-theme');

        let newTheme;
        if (!currentTheme || currentTheme === 'light') {
          newTheme = 'dark';
        } else {
          newTheme = 'light';
        }

        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);

        // Force a visual update
        document.body.style.transition = 'none';
        document.body.offsetHeight; // Trigger reflow
        document.body.style.transition = '';
      });

      return true;
    }
    return false;
  }

  // Try multiple times with delays
  if (!initThemeToggle()) {
    setTimeout(() => {
      if (!initThemeToggle()) {
        setTimeout(() => {
          initThemeToggle();
        }, 500);
      }
    }, 100);
  }
});
</script>
</body>
</html>
